# RFID 光線控制系統 使用說明

## 程式簡介

此程序運行於 **ESP32** 開發板，透過 **RC522 RFID 模組**來偵測卡片，並利用 **光敏電阻**的光線強度變化來控制 RFID 偵測功能的開啟與關閉。當光線強度超過指定閾值時，啟動 RFID 偵測並開始掃描卡片；當光線強度低於指定閾值時，則停止偵測功能。

## 硬體接線

### RFID 模組 (RC522)
| 引腳名稱 | 接線 (ESP32) |
| -------- | ------------- |
| SDA      | GPIO 5       |
| RST      | GPIO 0       |
| SCK      | GPIO 18      |
| MOSI     | GPIO 23      |
| MISO     | GPIO 19      |

### 光敏電阻
| 元件         | 接線 (ESP32) |
| ------------ | ------------- |
| 光敏電阻輸出 | GPIO 34      |

## 程式邏輯

1. **初始化**：
   - 設定 ESP32 與 RC522 RFID 模組的 SPI 通訊。
   - 初始化光敏電阻的輸入引腳。

2. **偵測流程**：
   - 每秒顯示一次系統狀態，包括光線強度、RFID 偵測狀態、卡片讀取狀態與當前卡片 UID。
   - 當環境光線強度大於 **LIGHT_THRESHOLD** 時，啟用 RFID 偵測。
   - 當光線強度低於 **DARK_THRESHOLD** 時，若已成功讀取卡片，則暫停 RFID 偵測。

3. **卡片讀取**：
   - 當 RFID 模組偵測到卡片時，讀取卡片的 UID 並顯示卡片資訊。
   - 若成功讀取，標記為讀取完成並停止卡片通訊。

4. **光線控制邏輯**：
   - 當環境變暗且卡片已讀取完成時，停用 RFID 偵測。
   - 當環境變亮時，重新啟動 RFID 偵測並重置卡片讀取狀態。

## 全域變數

- `cardReadCompleted`：紀錄是否完成卡片讀取。
- `rfidDetectionEnabled`：控制 RFID 偵測是否啟用。
- `currentCardUID`：儲存當前讀取到的卡片 UID。
- `LIGHT_THRESHOLD`：光線強度的啟動閾值。
- `DARK_THRESHOLD`：光線強度的停止閾值。

## 系統輸出

- 程序將在序列監控器中顯示系統狀態與卡片資訊，請於 **115200** 波特率下查看。
  - **光線強度**：顯示當前的光線強度值。
  - **卡片讀取狀態**：顯示卡片是否已完成讀取。
  - **RFID 偵測狀態**：顯示 RFID 偵測是否啟用。
  - **當前卡片 UID**：顯示當前偵測到的卡片 UID。

---

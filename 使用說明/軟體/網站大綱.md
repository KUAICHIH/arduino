# 網站功能大綱

## 1. 網站整體結構與功能模組

- **主要功能頁面**：

  1. `AnalyzePage`：用戶數據分析頁面，包含統計資料和圖表展示。
  2. `PlayPage`：機器選擇頁面，實現用戶機器分配與狀態更新。
  3. `ProfilePage`：用戶個人頁面，展示用戶資料及相關動態。
  4. `WeightPage`：用戶體重記錄頁面，新增並分析體重變化。

- **核心技術**：
  - **身份驗證**：Clerk 提供的 `auth` 和 `getAuth`。
  - **資料庫操作**：Prisma 查詢及資料關聯。
  - **即時更新**：WebSocket 實現機器狀態即時監控。
  - **圖表呈現**：Recharts 用於繪製柱狀圖與折線圖。

---

## 2. 詳細頁面功能

### 2.1 `AnalyzePage`

#### 功能

- 分析用戶的訓練記錄。
- 展示統計卡片與運動次數柱狀圖。

#### 關鍵組件

- **`StatCardGroup`**：顯示月總次數、月平均次數和當日運動時長。
- **`CustomBarChart`**：展示最近 30 天的運動次數（深蹲、仰臥起坐、伏地挺身）。

#### 技術亮點

- 使用 Clerk 驗證當前用戶與頁面用戶是否一致。
- Prisma 查詢訓練記錄並進行數據聚合。

---

### 2.2 `PlayPage`

#### 功能

- 渲染機器選擇頁面。
- 根據用戶選擇的機器更新數據並即時反饋。

#### 關鍵組件

- **`MachineSelectionPage`**：顯示機器列表，處理選擇和狀態更新。
- **WebSocket**：接收機器即時狀態更新，禁用無法使用的機器。

#### 技術亮點

- 使用 Prisma 動態查詢用戶及機器數據。
- 使用 WebSocket 管理機器的禁用狀態。

---

### 2.3 `ProfilePage`

#### 功能

- 展示用戶個人資料及動態。
- 根據用戶數據計算粉絲數、關注數和發文數。

#### 關鍵組件

- **`Feed`**：展示用戶的動態內容。
- **`LeftMenu` 和 `RightMenu`**：提供側欄導航與互動選項。

#### 技術亮點

- Prisma 查詢關聯數據（粉絲數、關注數等）。
- 判斷是否被封鎖，若被封鎖則返回 `404`。

---

### 2.4 `WeightPage`

#### 功能

- 新增體重數據。
- 分析用戶的體重變化並以圖表展示。

#### 關鍵組件

- **`AddWeight`**：新增體重數據的交互功能。
- **`FinanceChart`**：以折線圖展示體重變化趨勢。

#### 技術亮點

- 使用 Prisma 獲取體重記錄數據。
- 格式化日期顯示以優化用戶體驗。

---

## 3. 網站技術架構

### 3.1 身份驗證與授權

- **使用 Clerk**：
  - `auth` 和 `getAuth` 提供用戶驗證。
  - 檢查當前用戶是否有權訪問頁面。

### 3.2 資料庫管理

- **Prisma**：
  - 查詢用戶、訓練記錄、體重記錄等數據。
  - 關聯粉絲數、關注數等統計數據。

### 3.3 前端交互

- **即時更新**：
  - WebSocket 用於機器狀態監控。
- **圖表繪製**：
  - 使用 Recharts 實現柱狀圖和折線圖。

---

## 4. UI 布局設計

- **左側選單**：
  - 通過 `LeftMenu` 提供導航功能。
- **主內容區**：
  - 分頁顯示分析、機器選擇、個人資料及體重記錄。
- **右側選單**：
  - 提供用戶互動功能（如推薦用戶、快速導航）。

---

## 5. 未來優化建議

1. **資料處理優化**：
   - 增加後端數據緩存機制以提升查詢效率。
2. **圖表功能拓展**：
   - 增加更多的交互功能（如縮放、點擊查看詳細數據）。
3. **UI 響應式設計**：
   - 提升在小螢幕設備上的顯示效果。
4. **用戶體驗增強**：
   - 增加數據加載過程中的 `loading` 狀態提示。
5. **WebSocket 健壯性**：
   - 加強 WebSocket 的錯誤處理與重連機制。

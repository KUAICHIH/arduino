# 檔案功能大綱

## 1. 檔案路徑與結構

- **檔案名稱**：`ProfilePage`
- **功能模組**：
  - `@/components/feed/Feed`: 顯示使用者的動態（Feed）。
  - `@/components/leftMenu/LeftMenu`: 顯示左側選單。
  - `@/components/rightMenu/RightMenu`: 顯示右側選單。
  - `@/lib/client`: Prisma 資料庫客戶端，用於訪問資料庫。
  - `@clerk/nextjs/server`: 用於驗證使用者身份。
  - `next/navigation`: 提供錯誤頁面導航功能。
  - `next/image`: 用於高效處理和優化圖片顯示。

---

## 2. 主要功能大綱

### 2.1 資料獲取與處理

- **從 URL 參數獲取 `username`**

  - 從 `params.username` 提取用戶名稱。

- **查詢使用者資訊**

  - 使用 Prisma 的 `findFirst` 查詢符合 `username` 的使用者。
  - 查詢並關聯統計數據：
    - `followers`: 粉絲數。
    - `followings`: 關注人數。
    - `posts`: 發文數。

- **判斷使用者是否存在**

  - 若未找到使用者，則返回 `notFound()`。

- **判斷是否被封鎖**
  - 當當前用戶（`currentUserId`）存在時，檢查是否被該用戶封鎖。
  - 若被封鎖，返回 `notFound()`。

---

### 2.2 組件呈現與 UI 結構

- **左側選單**

  - 使用 `LeftMenu` 組件，顯示類型為 "profile" 的左側選單。

- **主內容區**

  1. **頭像和封面**
     - 顯示使用者的封面圖片（若無，則顯示預設圖片 `/noCover.png`）。
     - 顯示使用者的頭像圖片（若無，則顯示預設圖片 `/noAvatar.png`）。
  2. **用戶名**
     - 若使用者有 `name` 和 `surname`，顯示其全名，否則顯示 `username`。
  3. **數據統計**
     - 顯示使用者的帖子數（`posts`）、粉絲數（`followers`）、以及關注人數（`followings`）。
  4. **動態區域**
     - 使用 `Feed` 組件，傳遞 `username` 顯示該用戶的動態。

- **右側選單**
  - 使用 `RightMenu` 組件，傳入用戶數據 `user` 作為參數。

---

## 3. UI 布局

- 外層結構：`div` 使用 `flex` 佈局分為三部分：
  - **左側欄**
    - 僅在 `xl` 尺寸以上顯示，占寬度 20%。
  - **主內容**
    - 在 `lg` 螢幕顯示占比 70%，`xl` 螢幕占比 50%。
  - **右側欄**
    - 僅在 `lg` 尺寸以上顯示，占寬度 30%。

---

## 4. 需要注意的細節

- **Clerk 身份驗證**

  - 確保在 Pages Router 中正確使用 `getAuth()` 方法。

- **封鎖邏輯**

  - 判斷當前用戶是否被查詢的使用者封鎖，並正確處理 `isBlocked` 狀態。

- **Prisma 查詢**

  - 查詢時需要確保 `username` 唯一性，避免潛在的查詢衝突。

- **圖片路徑與預設值**
  - 確保 `user.cover` 和 `user.avatar` 有效，並處理為空時的預設圖片。

---

## 5. 未來擴展建議

1. **封鎖狀態優化**
   - 增加視覺提示，而非直接跳轉到錯誤頁。
2. **動態數據增強**
   - 增加其他可展示的統計數據（如評論數、喜歡數）。
3. **響應式改進**
   - 提高頁面在小屏幕設備上的顯示效果。
4. **右側選單拓展**
   - 提供更多互動功能（如推薦用戶、快速導航）。
